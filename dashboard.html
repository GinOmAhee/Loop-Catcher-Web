<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Loop Catcher Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap" rel="stylesheet" />
  <style>
    /* (your CSS here - no changes needed) */
  </style>
</head>
<body>

  <header>
    <h1 id="profileHeader">👋 Welcome back</h1>
  </header>

  <nav class="top-nav">
    <a href="profile.html">👤 Profile</a>
    <a href="settings.html">⚙️ Settings</a>
    <a href="learn.html">📘 Learn</a>
    <a href="search.html">🔍 Search</a>
    <a href="history.html">👀 Recently Viewed</a>
    <a href="nudges.html">🔔 Nudges</a>
    <button id="logoutBtn">🚪 Log Out</button>
  </nav>

  <div class="mindset-tagline" id="tagline">“Loading your mood...”</div>

  <script type="module">
    const fetchFirebaseConfig = async () => {
      const res = await fetch("https://us-central1-loop-catcher-firebase.cloudfunctions.net/getAPIKey");
      const config = await res.json();
      if (!config.projectId) config.projectId = "loop-catcher-firebase";
      return config;
    };

    const init = async () => {
      const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js");
      const { getAuth, signOut } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js");

      const config = await fetchFirebaseConfig();
      const app = initializeApp(config);
      const auth = getAuth(app);

      // 🔐 Logout logic
      const logoutBtn = document.getElementById("logoutBtn");
      logoutBtn.addEventListener("click", async () => {
        try {
          await signOut(auth);
          alert("Logged out successfully!");
          window.location.href = "signin.html";
        } catch (err) {
          console.error("Logout error:", err);
        }
      });

      // 🎨 Mood & Theme logic
      const emoji = localStorage.getItem("vibeEmoji") || "🌿";
      const label = (localStorage.getItem("vibeLabel") || "").trim();
      const tagline = localStorage.getItem("vibeTagline") || "Let’s start from where you are.";

      document.getElementById("profileHeader").textContent = `${emoji} ${label} Mode Activated`;
      document.getElementById("tagline").textContent = `“${tagline}”`;

      const moodThemeMap = {
        "Calm & Clear": "theme-calm",
        "Focused & Strategic": "theme-strategic",
        "Open & Reflective": "theme-reflective",
        "Driven & Bold": "theme-bold",
        "Playful & Inventive": "theme-playful"
      };
      const themeClass = moodThemeMap[label];
      if (themeClass) document.body.classList.add(themeClass);
    };

    init();
  </script>

</body>
</html>
