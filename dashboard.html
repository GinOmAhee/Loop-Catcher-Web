<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Loop Catcher Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap" rel="stylesheet" />
  <style>
    /* your CSS remains unchanged â€” clean and beautiful */
  </style>
</head>
<body>

  <header>
    <h1 id="profileHeader">ğŸ‘‹ Welcome back</h1>
  </header>

  <nav class="top-nav">
    <a href="profile.html">ğŸ‘¤ Profile</a>
    <a href="settings.html">âš™ï¸ Settings</a>
    <a href="learn.html">ğŸ“˜ Learn</a>
    <a href="search.html">ğŸ” Search</a>
    <a href="history.html">ğŸ‘€ Recently Viewed</a>
    <a href="nudges.html">ğŸ”” Nudges</a>
    <button id="logoutBtn">ğŸšª Log Out</button>
  </nav>

  <div class="mindset-tagline" id="tagline">â€œLoading your mood...â€</div>

  <script type="module">
    const fetchFirebaseConfig = async () => {
      try {
        const res = await fetch("https://us-central1-loop-catcher-firebase.cloudfunctions.net/getAPIKey");
        if (!res.ok) throw new Error("Network response was not ok");
        const config = await res.json();
        if (!config.projectId) config.projectId = "loop-catcher-firebase";
        return config;
      } catch (err) {
        console.error("Failed to fetch Firebase config:", err);
        alert("Could not load app config. Try again later.");
        throw err;
      }
    };

    const init = async () => {
      const { initializeApp } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js");
      const { getAuth, onAuthStateChanged, signOut } = await import("https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js");

      const firebaseConfig = await fetchFirebaseConfig();
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const logoutBtn = document.getElementById("logoutBtn");
      logoutBtn.addEventListener("click", async () => {
        try {
          await signOut(auth);
          alert("Logged out successfully!");
          window.location.href = "signin.html";
        } catch (error) {
          console.error("Logout Error:", error);
        }
      });

      // ğŸ‘‡ Mood/theme loading
      const emoji = localStorage.getItem("vibeEmoji") || "ğŸŒ¿";
      const label = (localStorage.getItem("vibeLabel") || "").trim();
      const tagline = localStorage.getItem("vibeTagline") || "Letâ€™s start from where you are.";

      document.getElementById("profileHeader").textContent = `${emoji} ${label} Mode Activated`;
      document.getElementById("tagline").textContent = `â€œ${tagline}â€`;

      const dashboard = document.body;
      const moodThemeMap = {
        "Calm & Clear": "theme-calm",
        "Focused & Strategic": "theme-strategic",
        "Open & Reflective": "theme-reflective",
        "Driven & Bold": "theme-bold",
        "Playful & Inventive": "theme-playful"
      };

      const themeClass = moodThemeMap[label];
      if (themeClass) {
        dashboard.classList.add(themeClass);
      } else {
        console.warn("âš ï¸ No matching theme for:", label);
      }
    };

    init();
  </script>

</body>
</html>
